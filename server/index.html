<html>
    <head>
        <title>Wake up | Her√§tyskello</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <!-- default theme tweaks -->
        <style>
            body {
                color: #dae6eb;
                background: rgba(0, 6, 18, 1);
                transition: background 1s, color 1s;
            }
        </style>
        <!-- dynamically changed -->
    </head>
    <body>
        <div class="d-flex flex-column min-vh-100 justify-content-center align-items-center" style="margin-top:-150">
            <div id="notification" class="alert alert-secondary" role="alert" style="visibility:hidden">Hey!</div>
            <h1>Wakey wakey</h1>
            <p>Eik√∂ laiska paskaperse ole noussut? üò¥</p>
            <div class="btn-group" role="group" aria-label="Basic example">
                <input type="password" class="form-control" id="secret" placeholder="Salasana">
                <button onclick="wakeUp('set')" class="btn btn-success" id="setBtn">Soita</button>
                <button onclick="wakeUp('unset')" class="btn btn-danger" id="unsetBtn">Lopeta</button>
            </div>
            <br>
            <small style="height: 20px" id="timeLog"> </small>
        </div>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script>
            var body = document.body;
            var notification = document.getElementById("notification");
            var timeLog = document.getElementById("timeLog");
            var setBtn = document.getElementById("setBtn");
            var unsetBtn = document.getElementById("unsetBtn");

            function changeView(wakeUp) {
                if (wakeUp) {
                    body.style.background = "rgba(255, 255, 255, 1)";
                    body.style.color = "#212529";
                } else {
                    body.style.background = "rgba(0, 6, 18, 1)";
                    body.style.color = "#dae6eb";
                }
            }

            function wakeUp(bl) {
                let secret = document.getElementById("secret").value;
                $.get("/wakey/" + bl + "?secret=" + secret, function(data) {
                    if (data == "success") {
                        notification.style.visibility = "visible";
                        if (bl == "set") {
                            changeView(true);
                            notification.innerHTML = "Her√§tet√§√§n... üòà";
                            setBtn.disabled = true;
                            unsetBtn.disabled = false;
                        } else {
                            changeView(false);
                            notification.innerHTML = "Her√§tys loppui! üòÅ";
                            setBtn.disabled = false;
                            unsetBtn.disabled = true;
                        }
                    }
                }).fail(function() {
                    notification.innerHTML = "Tapahtui virhe. üòû";
                    notification.style.visibility = "visible";
                });
            }

            $.get("/wakey/get", function(data) {
                if (data == "true") {
                    changeView(true);
                    notification.style.visibility = "visible";
                    notification.innerHTML = "Her√§tys jo k√§ynniss√§. üò≥";
                    setBtn.disabled = true;
                    unsetBtn.disabled = false;
                } else {
                    changeView(false);
                    setBtn.disabled = false;
                    unsetBtn.disabled = true;
                }
            });

            $.get("/wakey/log", function(data) {
                if (data != "") {
                    timeLog.innerHTML = " Previous call: " + data;
                }
            });
        </script>
    </body>
</html>
